// ============================================
// LANGUAGE SYSTEM - TRANSLATION OBJECT
// ============================================

const translations = {
  "ru": {
    "–ì–ª–∞–≤–Ω–∞—è": "–ì–ª–∞–≤–Ω–∞—è",
    "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞": "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞",
    "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã": "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã",
    "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
    "–ü—Ä–æ—á–µ–µ": "–ü—Ä–æ—á–µ–µ",
    "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏": "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏",
    "TRP RP": "TRP RP",
    "–£—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞": "–£—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞",
    "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"",
    "Discord": "Discord",
    "TeamSpeak": "TeamSpeak",
    "YouTube": "YouTube",
    "TikTok": "TikTok",
    "Telegram": "Telegram",
    "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ": "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"",
    "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏": "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ",
    "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!": "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!",
    "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.": "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.",
    "‚Üê –ù–∞–∑–∞–¥": "‚Üê –ù–∞–∑–∞–¥",
    "–î–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤": "–î–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
    "–ú–∞—Ä—à—Ä—É—Ç—ã": "–ú–∞—Ä—à—Ä—É—Ç—ã",
    "–†–µ–≥–ª–∞–º–µ–Ω—Ç —Ä–∞–¥–∏–æ–æ–±–º–µ–Ω–∞": "–†–µ–≥–ª–∞–º–µ–Ω—Ç —Ä–∞–¥–∏–æ–æ–±–º–µ–Ω–∞",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–¢–£ –∏ –î–¢–î": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–¢–£ –∏ –î–¢–î",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–ö–° –∏ –î–¢–î": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–ö–° –∏ –î–¢–î",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π",
    "–î–ª—è –æ—Ç–¥–µ–ª–æ–≤": "–î–ª—è –æ—Ç–¥–µ–ª–æ–≤",
    "–î–∏—Ä–µ–∫—Ç–æ—Ä –ì–¢–û–ü/–¢–ü–û–•": "–î–∏—Ä–µ–∫—Ç–æ—Ä –ì–¢–û–ü/–¢–ü–û–•",
    "–ö–û–£–ü": "–ö–û–£–ü",
    "–§–ê–û": "–§–ê–û",
    "–û–ë–î": "–û–ë–î",
    "–£–±–¶": "–£–±–¶",
    "–õ–µ–∫—Ü–∏–∏": "–õ–µ–∫—Ü–∏–∏",
    "–ó–∞–ø—É—Å–∫ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤": "–ó–∞–ø—É—Å–∫ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤",
    "–°—Ö–µ–º—ã –¥–µ–ø–æ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤": "–°—Ö–µ–º—ã –¥–µ–ø–æ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤",
    "–ê–Ω–∫–µ—Ç—ã": "–ê–Ω–∫–µ—Ç—ã",
    "–ó–∞—è–≤–ª–µ–Ω–∏—è": "–ó–∞—è–≤–ª–µ–Ω–∏—è",
    "–≠–∫–∑–∞–º–µ–Ω": "–≠–∫–∑–∞–º–µ–Ω",
    "–û—Ç–ø—É—Å–∫ & –ë–æ–ª—å–Ω–∏—á–Ω—ã–π": "–û—Ç–ø—É—Å–∫ & –ë–æ–ª—å–Ω–∏—á–Ω—ã–π",
    "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ & –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ": "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ & –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è & –ó–∞–º–µ–Ω–∞ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–∞": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è & –ó–∞–º–µ–Ω–∞ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–∞",
    "–†–µ–º–æ–Ω—Ç —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤": "–†–µ–º–æ–Ω—Ç —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤",
    "–ü–µ—Ä—Å–æ–Ω–∞–ª": "–ü–µ—Ä—Å–æ–Ω–∞–ª",
    "–ó–ù–ì–¢–£": "–ó–ù–ì–¢–£",
    "–î–¢–ü–ì–û & –î–¢–ü–æ–•": "–î–¢–ü–ì–û & –î–¢–ü–æ–•",
    "–î–¢–£": "–î–¢–£",
    "–î–ö–°": "–î–ö–°",
    "–¢–µ—Å—Ç—ã": "–¢–µ—Å—Ç—ã",
    "–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —ç–∫–∑–∞–º–µ–Ω": "–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —ç–∫–∑–∞–º–µ–Ω",
    "–ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é": "–ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É",
    "–ü—Ä–æ—á–∏–µ –∞–Ω–∫–µ—Ç—ã": "–ü—Ä–æ—á–∏–µ –∞–Ω–∫–µ—Ç—ã",
    "–†–µ–¥–∞–∫—Ç–æ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã": "–†–µ–¥–∞–∫—Ç–æ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã",
    "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ø–∞–≤–Ω–∞ –º–∞—à–∏–Ω": "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ø–∞–≤–Ω–∞ –º–∞—à–∏–Ω",
    "–°–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä–∞—Å–æ–∫": "–°–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä–∞—Å–æ–∫",
    "–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤": "–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤",
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä": "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä",
    "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ": "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ",
    "–¢—Ä–∏–±—É–Ω–∞ TDW": "–¢—Ä–∏–±—É–Ω–∞ TDW",
    "–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"",
    "–ß–ê–í–û - –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã": "–ß–ê–í–û - –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
    "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
    "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞": "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞",
    "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö",
    "–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞": "–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞",
    "–ö–æ–º–∞–Ω–¥—ã": "–ö–æ–º–∞–Ω–¥—ã",
    "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–Ω–∏–∫–∞": "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
    "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç",
    "VK": "VK"
  },
  "en": {
    "–ì–ª–∞–≤–Ω–∞—è": "Home",
    "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞": "Project Team",
    "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã": "Events and Shifts",
    "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "Documentation",
    "–ü—Ä–æ—á–µ–µ": "Other",
    "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏": "Social Media",
    "TRP RP": "TRP RP",
    "–£—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞": "Project Charter",
    "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "TRP RP Project Contacts",
    "Discord": "Discord",
    "TeamSpeak": "TeamSpeak",
    "YouTube": "YouTube",
    "TikTok": "TikTok",
    "Telegram": "Telegram",
    "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ": "VKontakte",
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "Legal Documentation of the TRP RP Project",
    "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏": "Privacy Policy",
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ": "Terms of Use",
    "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!": "The \"TRP RP\" project is not a legal entity and does not provide any services!",
    "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.": "¬© 2026 TRP RP. All rights reserved.",
    "‚Üê –ù–∞–∑–∞–¥": "‚Üê Back",
    "–î–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤": "For Employees",
    "–ú–∞—Ä—à—Ä—É—Ç—ã": "Routes",
    "–†–µ–≥–ª–∞–º–µ–Ω—Ç —Ä–∞–¥–∏–æ–æ–±–º–µ–Ω–∞": "Radio Communication Regulations",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–¢–£ –∏ –î–¢–î": "DTU and DTD Instructions",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–ö–° –∏ –î–¢–î": "DKS and DTD Instructions",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π": "Driver Instructions",
    "–î–ª—è –æ—Ç–¥–µ–ª–æ–≤": "For Departments",
    "–î–∏—Ä–µ–∫—Ç–æ—Ä –ì–¢–û–ü/–¢–ü–û–•": "Director GTOP/TPOH",
    "–ö–û–£–ü": "KOUP",
    "–§–ê–û": "FAO",
    "–û–ë–î": "OBD",
    "–£–±–¶": "UbTs",
    "–õ–µ–∫—Ü–∏–∏": "Lectures",
    "–ó–∞–ø—É—Å–∫ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤": "Trolleybus Launch",
    "–°—Ö–µ–º—ã –¥–µ–ø–æ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤": "Depot and Route Schemes",
    "–ê–Ω–∫–µ—Ç—ã": "Forms",
    "–ó–∞—è–≤–ª–µ–Ω–∏—è": "Applications",
    "–≠–∫–∑–∞–º–µ–Ω": "Exam",
    "–û—Ç–ø—É—Å–∫ & –ë–æ–ª—å–Ω–∏—á–Ω—ã–π": "Vacation & Sick Leave",
    "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ & –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ": "Dismissal & Reinstatement",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è & –ó–∞–º–µ–Ω–∞ —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–∞": "Registration & Trolleybus Replacement",
    "–†–µ–º–æ–Ω—Ç —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–æ–≤": "Trolleybus Repair",
    "–ü–µ—Ä—Å–æ–Ω–∞–ª": "Personnel",
    "–ó–ù–ì–¢–£": "ZNGTU",
    "–î–¢–ü–ì–û & –î–¢–ü–æ–•": "DTPGO & DTPokH",
    "–î–¢–£": "DTU",
    "–î–ö–°": "DKS",
    "–¢–µ—Å—Ç—ã": "Tests",
    "–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —ç–∫–∑–∞–º–µ–Ω": "Theoretical Exam",
    "–ü–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é": "Submit Appeal",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É": "Shift Registration",
    "–ü—Ä–æ—á–∏–µ –∞–Ω–∫–µ—Ç—ã": "Other Forms",
    "–†–µ–¥–∞–∫—Ç–æ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã": "Editors and Generators",
    "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ø–∞–≤–Ω–∞ –º–∞—à–∏–Ω": "Vehicle Spawn Generator",
    "–°–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä–∞—Å–æ–∫": "Create Liveries",
    "–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤": "Route Editor",
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä": "Informer",
    "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ": "Schedule",
    "–¢—Ä–∏–±—É–Ω–∞ TDW": "TDW Tribune",
    "–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "TRP RP Project Rules",
    "–ß–ê–í–û - –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã": "FAQ - Frequently Asked Questions",
    "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "Official Documentation",
    "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞": "Website Updates",
    "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö": "Database",
    "–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞": "Vehicle List",
    "–ö–æ–º–∞–Ω–¥—ã": "Commands",
    "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–Ω–∏–∫–∞": "Employee ID",
    "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç": "Admin Site",
    "VK": "VK"
  }
};

let originalHTML = null;

// ============================================
// THEME SYSTEM
// ============================================

function initThemeSystem() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);

    const themeBtn = document.getElementById('theme-btn');
    if (themeBtn) {
        themeBtn.addEventListener('click', handleThemeClick);
    }
}

function applyTheme(theme) {
    localStorage.setItem('theme', theme);
    const themeBtn = document.getElementById('theme-btn');
    if (theme === 'dark') {
        document.body.classList.add('dark-mode');
        if (themeBtn) themeBtn.textContent = '‚òÄÔ∏è';
    } else {
        document.body.classList.remove('dark-mode');
        if (themeBtn) themeBtn.textContent = 'üåô';
    }
}

function handleThemeClick() {
    const currentTheme = localStorage.getItem('theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
}

// ============================================
// LANGUAGE SYSTEM
// ============================================

function initLanguageSystem() {
    if (!originalHTML) {
        originalHTML = document.body.innerHTML;
    }
    const savedLanguage = localStorage.getItem('language') || 'ru';
    setLanguage(savedLanguage);
    updateLangButton(savedLanguage);
    setupLanguageButton();
    reinitializeEventListeners();
    initThemeSystem();
}

function setLanguage(lang) {
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
    document.body.innerHTML = originalHTML;

    function translateNode(node) {
        if (node.nodeType === 3) {
            let text = node.textContent.trim();
            if (text && translations[lang] && translations[lang][text]) {
                node.textContent = node.textContent.replace(text, translations[lang][text]);
            }
        } else if (node.nodeType === 1 && node.tagName !== 'SCRIPT') {
            for (let i = 0; i < node.childNodes.length; i++) {
                translateNode(node.childNodes[i]);
            }
        }
    }

    for (let i = 0; i < document.body.childNodes.length; i++) {
        translateNode(document.body.childNodes[i]);
    }

    reinitializeEventListeners();
    reinitializeTheme();
    initMobileMenu();
}

function updateLangButton(lang) {
    const langBtn = document.getElementById('lang-btn');
    if (langBtn) {
        langBtn.textContent = lang === 'ru' ? 'EN' : 'RU';
    }
}

function setupLanguageButton() {
    const langBtn = document.getElementById('lang-btn');
    if (langBtn) {
        const newLangBtn = langBtn.cloneNode(true);
        langBtn.parentNode.replaceChild(newLangBtn, langBtn);
        document.getElementById('lang-btn').addEventListener('click', function () {
            const currentLang = localStorage.getItem('language') || 'ru';
            const newLang = currentLang === 'ru' ? 'en' : 'ru';
            setLanguage(newLang);
            updateLangButton(newLang);
        });
    }
}

function reinitializeEventListeners() {
    setupLanguageButton();
    initDropdowns();
    initMobileMenu();
}

function reinitializeTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);
    const themeBtn = document.getElementById('theme-btn');
    if (themeBtn) {
        themeBtn.removeEventListener('click', handleThemeClick);
        themeBtn.addEventListener('click', handleThemeClick);
    }
    initDropdowns();
    initMobileMenu();
}

// ============================================
// MOBILE MENU
// ============================================

function initMobileMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    const navMenu = document.getElementById('nav-menu');
    const navLinks = navMenu ? navMenu.querySelectorAll('.nav-link') : [];

    const backBtn = document.getElementById('menu-back-btn');
    if (backBtn) {
        backBtn.addEventListener('click', function () {
            const toggle = document.getElementById('menu-toggle');
            if (toggle && navMenu) {
                toggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        });
    }

    if (menuToggle) {
        menuToggle.addEventListener('click', function () {
            menuToggle.classList.toggle('active');
            navMenu.classList.toggle('active');
            document.body.classList.toggle('menu-open');
        });
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function () {
            if (menuToggle && navMenu) {
                menuToggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        });
    });

    document.addEventListener('click', function (event) {
        if (navMenu && menuToggle &&
            !navMenu.contains(event.target) &&
            !menuToggle.contains(event.target)) {
            menuToggle.classList.remove('active');
            navMenu.classList.remove('active');
            document.body.classList.remove('menu-open');
        }
    });

    window.addEventListener('resize', function () {
        if (window.innerWidth > 768) {
            if (menuToggle && navMenu) {
                menuToggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        }
    });
}

// ============================================
// NAVBAR ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è, —Ç–µ–º–Ω–µ–µ—Ç –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
// ============================================

function updateNavbar() {
    const navbar = document.querySelector('.navbar');
    if (!navbar) return;
    if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
    } else {
        navbar.classList.remove('scrolled');
    }
}

window.addEventListener('scroll', updateNavbar, { passive: true });
window.addEventListener('DOMContentLoaded', updateNavbar);
updateNavbar();

// ============================================
// DROPDOWN –ú–ï–ù–Æ
// ============================================

function initDropdowns() {
    const hasPointer = () => window.matchMedia('(hover: hover) and (pointer: fine)').matches;

    document.querySelectorAll('.nav-item.has-dropdown').forEach(function (item) {
        let hideTimer = null;

        const openItem = () => {
            clearTimeout(hideTimer);
            item.parentNode.querySelectorAll('.nav-item.has-dropdown.open').forEach(function (sib) {
                if (sib !== item) {
                    sib.classList.remove('open');
                    sib.querySelectorAll('.dropdown-submenu.open').forEach(s => s.classList.remove('open'));
                }
            });
            item.classList.add('open');
        };

        const closeItem = (delay) => {
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => {
                item.classList.remove('open');
                item.querySelectorAll('.dropdown-submenu.open').forEach(s => s.classList.remove('open'));
            }, delay);
        };

        item.addEventListener('mouseenter', function () {
            if (hasPointer()) openItem();
        });
        item.addEventListener('mouseleave', function () {
            if (hasPointer()) closeItem(600);
        });

        const toggle = item.querySelector(':scope > .dropdown-toggle');
        if (toggle) {
            const newToggle = toggle.cloneNode(true);
            toggle.parentNode.replaceChild(newToggle, toggle);
            newToggle.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                if (!hasPointer()) {
                    const wasOpen = item.classList.contains('open');
                    item.parentNode.querySelectorAll('.nav-item.has-dropdown.open').forEach(function (sib) {
                        sib.classList.remove('open');
                        sib.querySelectorAll('.dropdown-submenu.open').forEach(s => s.classList.remove('open'));
                    });
                    if (!wasOpen) item.classList.add('open');
                }
            });
        }
    });

    document.querySelectorAll('.dropdown-submenu').forEach(function (sub) {
        let hideTimer = null;

        const openSub = () => {
            clearTimeout(hideTimer);
            sub.parentNode.querySelectorAll('.dropdown-submenu.open').forEach(s => {
                if (s !== sub) s.classList.remove('open');
            });
            sub.classList.add('open');
        };

        const closeSub = (delay) => {
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => sub.classList.remove('open'), delay);
        };

        sub.addEventListener('mouseenter', function () {
            if (hasPointer()) openSub();
        });
        sub.addEventListener('mouseleave', function () {
            if (hasPointer()) closeSub(600);
        });

        const link = sub.querySelector(':scope > .dropdown-link');
        if (link) {
            const newLink = link.cloneNode(true);
            link.parentNode.replaceChild(newLink, link);
            newLink.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                if (!hasPointer()) {
                    const wasOpen = sub.classList.contains('open');
                    sub.parentNode.querySelectorAll('.dropdown-submenu.open').forEach(s => s.classList.remove('open'));
                    if (!wasOpen) sub.classList.add('open');
                }
            });
        }
    });

    document.addEventListener('click', function (e) {
        if (!e.target.closest('.nav-item.has-dropdown')) {
            document.querySelectorAll('.nav-item.has-dropdown.open').forEach(function (item) {
                item.classList.remove('open');
                item.querySelectorAll('.dropdown-submenu.open').forEach(s => s.classList.remove('open'));
            });
        }
    });
}

// ============================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
// ============================================

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        initThemeSystem();
        initLanguageSystem();
        initMobileMenu();
        initDropdowns();
    });
} else {
    initThemeSystem();
    initLanguageSystem();
    initMobileMenu();
    initDropdowns();
}
