// ============================================
// LANGUAGE SYSTEM - TRANSLATION OBJECT
// ============================================

const translations = {
  "ru": {
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    "–ù–∞–∑–∞–¥": "–ù–∞–∑–∞–¥",
    "–ì–ª–∞–≤–Ω–∞—è": "–ì–ª–∞–≤–Ω–∞—è",
    "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞": "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞",
    "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã": "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã",
    "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
    "–ü—Ä–æ—á–µ–µ": "–ü—Ä–æ—á–µ–µ",
    "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏": "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏",
    "TRP RP": "TRP RP",

    // –ì–µ—Ä–æ–π
    "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—ã": "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—ã",

    // –°–µ–∫—Ü–∏–∏
    "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π": "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É",
    "–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ —Å–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞ TRP RP –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.": "–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ —Å–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞ TRP RP –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.",
    "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Å–º–µ–Ω–µ –∏–ª–∏ –µ—ë –æ—Ç–º–µ–Ω—ã. –ó–∞—è–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.": "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Å–º–µ–Ω–µ –∏–ª–∏ –µ—ë –æ—Ç–º–µ–Ω—ã. –ó–∞—è–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.",

    // –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"",
    "Discord": "Discord",
    "TeamSpeak": "TeamSpeak",
    "YouTube": "YouTube",
    "TikTok": "TikTok",
    "Telegram": "Telegram",
    "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ": "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"",
    "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏": "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ",
    "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!": "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!",
    "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.": "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã."
  },
  "en": {
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    "–ù–∞–∑–∞–¥": "Back",
    "–ì–ª–∞–≤–Ω–∞—è": "Home",
    "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞": "Project Team",
    "–°–æ–±—ã—Ç–∏—è –∏ —Å–º–µ–Ω—ã": "Events and Shifts",
    "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è": "Documentation",
    "–ü—Ä–æ—á–µ–µ": "Other",
    "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏": "Social Media",
    "TRP RP": "TRP RP",

    // –ì–µ—Ä–æ–π
    "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—ã": "Event Calendar and Shift Registration",

    // –°–µ–∫—Ü–∏–∏
    "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π": "Event Calendar",
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–º–µ–Ω—É": "Shift Registration",
    "–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ —Å–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞ TRP RP –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.": "Follow the schedule of TRP RP project events and shifts in real time.",
    "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Å–º–µ–Ω–µ –∏–ª–∏ –µ—ë –æ—Ç–º–µ–Ω—ã. –ó–∞—è–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.": "Fill out the application to participate in a shift or cancel it. Applications are processed within 5 business days.",

    // –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    "–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "TRP RP Project Contacts",
    "Discord": "Discord",
    "TeamSpeak": "TeamSpeak",
    "YouTube": "YouTube",
    "TikTok": "TikTok",
    "Telegram": "Telegram",
    "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ": "VKontakte",
    "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ \"TRP RP\"": "Legal Documentation of the TRP RP Project",
    "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏": "Privacy Policy",
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ": "Terms of Use",
    "–ü—Ä–æ–µ–∫—Ç \"TRP RP\" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥!": "The \"TRP RP\" project is not a legal entity and does not provide any services!",
    "¬© 2026 TRP RP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.": "¬© 2026 TRP RP. All rights reserved."
  }
};

let originalHTML = null;

// ============================================
// THEME SYSTEM
// ============================================

function initThemeSystem() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);

    const themeBtn = document.getElementById('theme-btn');
    if (themeBtn) {
        themeBtn.addEventListener('click', handleThemeClick);
    }
}

function applyTheme(theme) {
    localStorage.setItem('theme', theme);
    const themeBtn = document.getElementById('theme-btn');

    if (theme === 'dark') {
        document.body.classList.add('dark-mode');
        if (themeBtn) themeBtn.textContent = '‚òÄÔ∏è';
    } else {
        document.body.classList.remove('dark-mode');
        if (themeBtn) themeBtn.textContent = 'üåô';
    }
}

function handleThemeClick() {
    const currentTheme = localStorage.getItem('theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
}

// ============================================
// LANGUAGE SYSTEM
// ============================================

function initLanguageSystem() {
    if (!originalHTML) {
        originalHTML = document.body.innerHTML;
    }

    const savedLanguage = localStorage.getItem('language') || 'ru';
    setLanguage(savedLanguage);
    updateLangButton(savedLanguage);
    setupLanguageButton();
    reinitializeEventListeners();
    initThemeSystem();
}

function setLanguage(lang) {
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;

    document.body.innerHTML = originalHTML;

    function translateNode(node) {
        if (node.nodeType === 3) {
            let text = node.textContent.trim();
            if (text && translations[lang] && translations[lang][text]) {
                node.textContent = node.textContent.replace(text, translations[lang][text]);
            }
        } else if (node.nodeType === 1 && node.tagName !== 'SCRIPT') {
            for (let i = 0; i < node.childNodes.length; i++) {
                translateNode(node.childNodes[i]);
            }
        }
    }

    for (let i = 0; i < document.body.childNodes.length; i++) {
        translateNode(document.body.childNodes[i]);
    }

    reinitializeEventListeners();
    reinitializeTheme();
    initMobileMenu();
}

function updateLangButton(lang) {
    const langBtn = document.getElementById('lang-btn');
    if (langBtn) {
        langBtn.textContent = lang === 'ru' ? 'EN' : 'RU';
    }
}

function setupLanguageButton() {
    const langBtn = document.getElementById('lang-btn');
    if (langBtn) {
        const newLangBtn = langBtn.cloneNode(true);
        langBtn.parentNode.replaceChild(newLangBtn, langBtn);

        document.getElementById('lang-btn').addEventListener('click', function () {
            const currentLang = localStorage.getItem('language') || 'ru';
            const newLang = currentLang === 'ru' ? 'en' : 'ru';
            setLanguage(newLang);
            updateLangButton(newLang);
        });
    }
}

function reinitializeEventListeners() {
    setupLanguageButton();

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
    
    initMobileMenu();
}

function reinitializeTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    applyTheme(savedTheme);

    const themeBtn = document.getElementById('theme-btn');
    if (themeBtn) {
        themeBtn.removeEventListener('click', handleThemeClick);
        themeBtn.addEventListener('click', handleThemeClick);
    }
    
    initMobileMenu();
}

// ============================================
// MOBILE MENU TOGGLE
// ============================================

function initMobileMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    const navMenu = document.getElementById('nav-menu');
    const navLinks = navMenu ? navMenu.querySelectorAll('.nav-link') : [];

    // Close menu when back arrow is clicked
    const backBtn = document.getElementById('menu-back-btn');
    if (backBtn) {
        backBtn.addEventListener('click', function() {
            const toggle = document.getElementById('menu-toggle');
            if (toggle && navMenu) {
                toggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        });
    }

    // Toggle menu when hamburger is clicked
    if (menuToggle) {
        // Remove old listeners by cloning
        const newToggle = menuToggle.cloneNode(true);
        menuToggle.parentNode.replaceChild(newToggle, menuToggle);
        newToggle.addEventListener('click', function() {
            newToggle.classList.toggle('active');
            navMenu.classList.toggle('active');
            document.body.classList.toggle('menu-open');
        });
    }

    // Close menu when a link is clicked
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            const toggle = document.getElementById('menu-toggle');
            if (toggle && navMenu) {
                toggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        });
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
        const toggle = document.getElementById('menu-toggle');
        if (navMenu && toggle && 
            !navMenu.contains(event.target) && 
            !toggle.contains(event.target)) {
            toggle.classList.remove('active');
            navMenu.classList.remove('active');
            document.body.classList.remove('menu-open');
        }
    });

    // Close menu on window resize if screen is large enough
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            const toggle = document.getElementById('menu-toggle');
            if (toggle && navMenu) {
                toggle.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
        }
    });
}

// ============================================
// NAVBAR ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è, —Ç–µ–º–Ω–µ–µ—Ç –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
// ============================================

window.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (!navbar) return;
    if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
    } else {
        navbar.classList.remove('scrolled');
    }
});

// ============================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
// ============================================

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        initThemeSystem();
        initLanguageSystem();
        initMobileMenu();
    });
} else {
    initThemeSystem();
    initLanguageSystem();
    initMobileMenu();
}

console.log('%cüéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç TRP RP!', 'color: #4a90e2; font-size: 16px; font-weight: bold;');
